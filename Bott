def currency(update: Update, context: CallbackContext):
    cur = update.message.text.strip().upper()

    if cur not in ("MDL", "EUR", "USD"):
        update.message.reply_text(
            "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð²Ð°Ð»ÑŽÑ‚Ñƒ ÐºÐ½Ð¾Ð¿ÐºÐ¾Ð¹ Ð½Ð¸Ð¶Ðµ ðŸ‘‡",
            reply_markup=ReplyKeyboardMarkup(
                [["MDL", "EUR", "USD"]],
                resize_keyboard=True,
                one_time_keyboard=True
            )
        )
        return CURRENCY

    before = context.user_data["before"]
    after = context.user_data["after"]

    discount = (before - after) / before * 100

    if discount < 20:
        update.message.reply_text(
            f"âŒ Ð¡ÐºÐ¸Ð´ÐºÐ° {discount:.1f}%\nÐœÐ¸Ð½Ð¸Ð¼ÑƒÐ¼ â€” 20%",
            reply_markup=ReplyKeyboardRemove()
        )
        context.user_data.clear()
        return ConversationHandler.END

    context.user_data["currency"] = cur
    context.user_data["discount"] = discount

    # â— Ð’ÐÐ–ÐÐž: Ð£Ð‘Ð˜Ð ÐÐ•Ðœ Ð’Ð¡Ð• ÐšÐÐžÐŸÐšÐ˜ ÐœÐ•ÐÐ®
    update.message.reply_text(
        "ðŸ“ ÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ Ð³ÐµÐ¾Ð»Ð¾ÐºÐ°Ñ†Ð¸ÑŽ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°",
        reply_markup=ReplyKeyboardMarkup(
            [[KeyboardButton("ðŸ“ ÐŸÐ¾Ð´ÐµÐ»Ð¸Ñ‚ÑŒÑÑ Ð»Ð¾ÐºÐ°Ñ†Ð¸ÐµÐ¹", request_location=True)]],
            resize_keyboard=True,
            one_time_keyboard=True
        )
    )

    return LOCATION
