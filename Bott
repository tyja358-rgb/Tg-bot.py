def store_select(update, context):
    choice = update.message.text

    if choice == "‚ûï –ù–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω":
        # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω
        update.message.reply_text("‚úèÔ∏è –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞:")
        return STORE_NAME
    else:
        # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–∞–≥–∞–∑–∏–Ω
        context.user_data["store_name"] = choice
        update.message.reply_text(
            f"‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏ –º–∞–≥–∞–∑–∏–Ω: {choice}\n"
            f"üìç {context.user_data.get('address','–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω')}"
        )
        return ConversationHandler.END  # –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è







def add_store_location(update, context):
    global stores
    loc = update.message.location
    if not loc:
        update.message.reply_text("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")
        return ADD_STORE_LOCATION  # –æ—Å—Ç–∞—ë–º—Å—è –Ω–∞ —ç—Ç–æ–º —à–∞–≥–µ

    coords = (loc.latitude, loc.longitude)
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∞–¥—Ä–µ—Å–∞
    address = geolocator.reverse(coords).address
    context.user_data["address"] = address  # —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∞–¥—Ä–µ—Å

    # üîπ –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –º–∞–≥–∞–∑–∏–Ω—ã –ø–æ —ç—Ç–æ–º—É –∞–¥—Ä–µ—Å—É
    existing_stores = [name for name, data in stores.items() if data["address"] == address]

    if existing_stores:
        # –ï—Å–ª–∏ –µ—Å—Ç—å –º–∞–≥–∞–∑–∏–Ω—ã ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ + –∫–Ω–æ–ø–∫—É –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π
        keyboard = [[s] for s in sorted(existing_stores)]
        keyboard.append(["‚ûï –ù–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω"])
        update.message.reply_text(
            f"–ê–¥—Ä–µ—Å: {address}\nüè¨ –í—ã–±–µ—Ä–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π:",
            reply_markup=ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
        )
        return STORE_SELECT  # –∂–¥—ë–º –≤—ã–±–æ—Ä –º–∞–≥–∞–∑–∏–Ω–∞ –∏–ª–∏ "‚ûï –ù–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω"
    else:
        # –ï—Å–ª–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –Ω–µ—Ç ‚Äî —Å—Ä–∞–∑—É –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞
        update.message.reply_text(
            f"–ê–¥—Ä–µ—Å: {address}\n‚úèÔ∏è –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞:",
            reply_markup=ReplyKeyboardRemove()  # —É–±–∏—Ä–∞–µ–º –∫–Ω–æ–ø–∫–∏, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –ª–∏—à–Ω–∏—Ö
        )
        return STORE_NAME
