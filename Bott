def store_select(update, context):
    choice = update.message.text
    if choice == "‚ûï –ù–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω":
        update.message.reply_text("‚úèÔ∏è –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞:")
        return STORE_NAME
    else:
        # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–∞–≥–∞–∑–∏–Ω
        context.user_data["store_name"] = choice
        update.message.reply_text(f"‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏ –º–∞–≥–∞–∑–∏–Ω: {choice}\nüìç {context.user_data.get('address','–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω')}")
        return ConversationHandler.END





def add_store_location(update, context):
    global stores
    loc = update.message.location
    if not loc:
        update.message.reply_text("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")
        return ADD_STORE_LOCATION

    coords = (loc.latitude, loc.longitude)
    address = geolocator.reverse(coords).address
    context.user_data["address"] = address  # —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∞–¥—Ä–µ—Å

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –º–∞–≥–∞–∑–∏–Ω—ã –ø–æ —ç—Ç–æ–º—É –∞–¥—Ä–µ—Å—É
    existing_stores = [name for name, data in stores.items() if data["address"] == address]

    if existing_stores:
        # –ï—Å–ª–∏ –µ—Å—Ç—å –º–∞–≥–∞–∑–∏–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞
        keyboard = [[s] for s in sorted(existing_stores)]
        keyboard.append(["‚ûï –ù–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω"])  # –∫–Ω–æ–ø–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ
        update.message.reply_text(
            f"–ê–¥—Ä–µ—Å: {address}\nüè¨ –í—ã–±–µ—Ä–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π:",
            reply_markup=ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
        )
        return STORE_SELECT  # –∂–¥—ë–º –≤—ã–±–æ—Ä –º–∞–≥–∞–∑–∏–Ω–∞ –∏–ª–∏ –Ω–∞–∂–∞—Ç–∏–µ ‚ûï –ù–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω
    else:
        # –ï—Å–ª–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –Ω–µ—Ç ‚Äî —Å—Ä–∞–∑—É –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ
        update.message.reply_text(
            f"–ê–¥—Ä–µ—Å: {address}\n‚úèÔ∏è –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞:",
        )
        return STORE_NAME



