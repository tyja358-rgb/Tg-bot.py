from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import Updater, CommandHandler
from shops import get_conversation_handler  # Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ ÑÐºÐ¸Ð´Ð¾Ðº
from db import init_db  # ÐµÑÐ»Ð¸ Ñƒ Ñ‚ÐµÐ±Ñ ÐµÑÑ‚ÑŒ Ð±Ð°Ð·Ð°, Ð¸Ð½Ð°Ñ‡Ðµ Ð¼Ð¾Ð¶Ð½Ð¾ ÑƒÐ±Ñ€Ð°Ñ‚ÑŒ

# Ð¢Ð¾ÐºÐµÐ½ Ð±Ð¾Ñ‚Ð°
TOKEN = "8465624288:AAGKPaKjgGKxOZ3e1xN4pFTI_gTzP3KiVjc"

# --- Ð¡Ð¢ÐÐ Ð¢ÐžÐ’ÐÐ¯ ÐšÐžÐœÐÐÐ”Ð ---
def start(update: Update, context):
    context.user_data.clear()  # Ð¾Ñ‡Ð¸Ñ‰Ð°ÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¿Ñ€Ð¸ Ð½Ð¾Ð²Ð¾Ð¼ Ð·Ð°Ð¿ÑƒÑÐºÐµ
    keyboard = [["âž• Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑÐºÐ¸Ð´ÐºÑƒ"]]  # ÐºÐ½Ð¾Ð¿ÐºÐ° Ð´Ð»Ñ ÑÑ‚Ð°Ñ€Ñ‚Ð° Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÑÐºÐ¸Ð´ÐºÐ¸
    update.message.reply_text(
        "Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ ðŸ‘‹",
        reply_markup=ReplyKeyboardMarkup(
            keyboard, resize_keyboard=True, one_time_keyboard=True
        )
    )

# --- ÐžÐ¡ÐÐžÐ’ÐÐÐ¯ Ð¤Ð£ÐÐšÐ¦Ð˜Ð¯ ---
def main():
    print(">>> MAIN STARTED <<<")

    # Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð±Ð°Ð·Ñ‹ (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ)
    init_db()

    updater = Updater(TOKEN, use_context=True)
    dp = updater.dispatcher

    # Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€ÑƒÐµÐ¼ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /start
    dp.add_handler(CommandHandler("start", start))

    # Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€ÑƒÐµÐ¼ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÑÐºÐ¸Ð´ÐºÐ¸ Ð¸Ð· shops.py
    dp.add_handler(get_conversation_handler())

    # Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ polling
    updater.start_polling()
    print(">>> POLLING START <<<")
    updater.idle()

if __name__ == "__main__":
    main()
