# --- Шаг 1: спрашиваем название магазина ---
def add_store_name(update: Update, context: CallbackContext):
    context.user_data["store_name"] = update.message.text  # сохраняем название

    # Просим поделиться геолокацией
    update.message.reply_text(
        "Отлично! Теперь добавьте адрес магазина.\n⚠️ Включите GPS и нажмите кнопку 'Поделиться местоположением'.",
        reply_markup=ReplyKeyboardMarkup(
            [[KeyboardButton("Поделиться местоположением", request_location=True)]],
            one_time_keyboard=True
        )
    )

    return ADD_STORE_LOCATION  # <-- переходим к шагу с локацией

# --- Шаг 2: получаем геолокацию и сохраняем магазин ---
def add_store_location(update: Update, context: CallbackContext):
    loc = update.message.location
    if not loc:
        update.message.reply_text("Не удалось получить локацию. Попробуйте снова.")
        return ADD_STORE_LOCATION  # остаёмся на этом шаге

    coords = (loc.latitude, loc.longitude)
    address = geolocator.reverse(coords).address
    store_name = context.user_data["store_name"]

    stores[store_name] = {"coords": coords, "address": address, "products": []}

    update.message.reply_text(f"Магазин '{store_name}' добавлен с адресом:\n{address}")

    return -1  # завершаем ConversationHandler
